{{ if hugo.IsMultilingual }}
<div class="language-switcher">
  <button class="lang-toggle" aria-label="Select language" aria-expanded="false">
    <span class="current-lang">{{ .Lang | upper }}</span>
    <svg class="lang-icon" width="12" height="12" viewBox="0 0 12 12" fill="none">
      <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>
  <ul class="lang-dropdown">
    {{ $currentLang := .Lang }}
    {{ $currentPage := . }}
    {{ range site.Languages }}
      {{ if ne .Lang $currentLang }}
      <li>
        {{ $translationFound := false }}
        {{ range $currentPage.Translations }}
          {{ if eq .Lang $.Lang }}
            <a href="{{ .Permalink }}" class="lang-option" hreflang="{{ .Lang }}">
              {{ .Language.LanguageName }}
            </a>
            {{ $translationFound = true }}
          {{ end }}
        {{ end }}
        {{ if not $translationFound }}
        <a href="/{{ .Lang }}/" class="lang-option" hreflang="{{ .Lang }}">
          {{ .LanguageName }}
        </a>
        {{ end }}
      </li>
      {{ end }}
    {{ end }}
  </ul>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const toggle = document.querySelector('.lang-toggle');
  const dropdown = document.querySelector('.lang-dropdown');

  if (toggle && dropdown) {
    toggle.addEventListener('click', function(e) {
      e.stopPropagation();
      const expanded = this.getAttribute('aria-expanded') === 'true';
      this.setAttribute('aria-expanded', !expanded);
      dropdown.classList.toggle('is-open');
    });

    document.addEventListener('click', function() {
      toggle.setAttribute('aria-expanded', 'false');
      dropdown.classList.remove('is-open');
    });
  }
});
</script>
{{ end }}
